<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Spielauswahl</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>

    <link rel="stylesheet" href="style.css">

    <!--    mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=0.8, maximum-scale=0.8, user-scalable=0, width=device-width, shrink-to-fit=no">
    <script src="https://kit.fontawesome.com/8482ce4752.js" crossorigin="anonymous"></script>

    <!--    icons-->
    <link rel="apple-touch-icon" sizes="120x120" href="../icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../icons/favicon-16x16.png">
    <link rel="manifest" href="../icons/site.webmanifest">
    <link rel="mask-icon" href="../icons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="../icons/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="../icons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <!--   og link-->
    <meta property="og:title" content="Spielauswahl">
    <meta property="og:description" content="Eine Auswahl an Spielen, die im Game Of Luna Universum spielen.">
    <meta property="og:image" content="https://leonlp9.github.io/GameOfLuna/img/skins/clicker.webp">
    <meta property="og:type" content="website">

    <!--    crawler-->
    <meta name="description" content="Eine Auswahl an Spielen, die im Game Of Luna Universum spielen.">
    <meta name="keywords" content="Luna, Memory, Luna Memory, Game, Luna Game, Luna Memory Game, Luna Memory Game Of Luna, Game Of Luna, Luna Game Of Luna, Luna Memory Game Of Luna">
    <meta name="author" content="Leon lp9">
    <meta name="robots" content="index, follow">
    <meta name="revisit-after" content="3 days">
    <meta name="language" content="German">
    <meta name="distribution" content="Global">
    <meta name="rating" content="General">
</head>
<body>
    <h1>Spielauswahl</h1>
    <div class="container">
        <div class="gamegrid"></div>
    </div>
</body>

<script>

    const links = [
        "/GameOfLuna/lunaclicker",
        "/GameOfLuna/lunamemory",
        "/GameOfLuna/lunaschach"
    ]

    function buildGameCard(link) {
        const gameCard = document.createElement("a");
        gameCard.href = link;
        gameCard.classList.add("gamecard");

        const img = document.createElement("img");
        gameCard.appendChild(img);

        const div = document.createElement("div");
        gameCard.appendChild(div);

        const h2 = document.createElement("h2");
        div.appendChild(h2);

        const p = document.createElement("p");
        div.appendChild(p);

        return gameCard;
    }

    links.forEach(function (link) {
        const gameCard = buildGameCard(link);
        document.querySelector(".gamegrid").appendChild(gameCard);
    });

    //für alle a tags
    document.querySelectorAll("a").forEach(function (a) {
        a.addEventListener("click", function (e) {
            e.preventDefault();

            playInAnimation(function () {
                window.location.href = a.getAttribute("href");
            });
        });

        //crawl auf der seite nach der meta description und setze sie als text für das p element
        fetch(a.getAttribute("href"))
            .then(function (response) {
                return response.text();
            })
            .then(function (html) {
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, "text/html");
                const description = doc.querySelector('meta[name="description"]').getAttribute("content");
                const title = doc.querySelector('title').innerText;
                const ogImage = doc.querySelector('meta[property="og:image"]').getAttribute("content");
                a.querySelector("p").innerText = description;
                a.querySelector("h2").innerText = title;
                a.querySelector("img").src = ogImage;
            });
    });

    let loadingAnimation = null;

    function playInAnimation(callback) {
        loadingAnimation = document.createElement("div");
        loadingAnimation.style.position = "fixed";
        loadingAnimation.style.top = "0";
        loadingAnimation.style.left = "0";
        loadingAnimation.style.width = "100%";
        loadingAnimation.style.height = "100%";
        loadingAnimation.style.backgroundColor = "white";
        loadingAnimation.style.opacity = "0";
        loadingAnimation.style.transition = "opacity 0.25s cubic-bezier(0.4, 0, 0.2, 1)";
        loadingAnimation.style.zIndex = "1000";
        document.body.appendChild(loadingAnimation);

        setTimeout(function () {
            loadingAnimation.style.opacity = "1";
        }, 0);

        setTimeout(function () {
            callback()
        }, 250);
    }

    //event, wenn die seite wieder aufgerufen wurde (z.B. durch die zurück wisch geste, wo das die vorherige seite wieder angezeigt wird ohne sie neu zu laden
    window.addEventListener("pageshow", function (event) {
        if (event.persisted) {
            loadingAnimation.remove();
        }
    });

</script>

</html>